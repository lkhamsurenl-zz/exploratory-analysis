View(eval_data)
head(eval_data)
eval_data %>%
summarise(precision=sum(ifelse(locale == google_translate_locale, 1, 0)) / n())
eval_data %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(locale == google_translate_locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
valid_data %>%
summarise(
langid_precision = sum(ifelse(locale == langid_locale, 1, 0)) / n(),
langdetect_precision = sum(ifelse(locale == langdetect_locale, 1, 0)) / n()
)
valid_data %>%
group_by(locale) %>%
summarise(
langid_precision = sum(ifelse(locale == langid_locale, 1, 0)) / n()
)  %>%
ggplot(aes(x = reorder(locale, langid_precision), y = langid_precision)) +
geom_bar(stat="identity")
valid_data %>%
group_by(locale) %>%
summarise(
langdetect_precision = sum(ifelse(locale == langdetect_locale, 1, 0)) / n()
)  %>%
ggplot(aes(x = reorder(locale, langdetect_precision), y = langdetect_precision)) +
geom_bar(stat="identity")
langid_langdetect <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
valid_data %>%
mutate(mix_locale = ifelse(langid_prob >= th, langid_locale, langdetect_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
langid_langdetect[nrow(langid_langdetect) + 1,] = c(th, p)
}
langid_langdetect %>%
ggplot(aes(x = threshold, y = precision)) +
geom_line()
max_precision <- (langid_langdetect %>% summarise(max_precision = max(precision)))$max_precision
langid_threshold <- head(langid_langdetect %>% filter(precision == max_precision), 1)$threshold
eval_data %>%
mutate(mix_locale = ifelse(langid_prob >= langid_threshold, langid_locale, langdetect_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
library(tidyverse)
eval_data <- read.csv(
"data/eval_data.csv",
sep="\t",
blank.lines.skip=TRUE,
stringsAsFactors=FALSE
)
eval_data <- eval_data %>%
mutate(
langid_prob = as.numeric(langid_prob),
langdetect_prob = as.numeric(langdetect_prob)
)
valid_data <- read.csv(
"data/valid_data.csv",
sep="\t",
blank.lines.skip=TRUE,
stringsAsFactors=FALSE
)
valid_data <- valid_data %>%
mutate(
langid_prob = as.numeric(langid_prob),
langdetect_prob = as.numeric(langdetect_prob)
)
head(eval_data)
eval_data %>%
summarise(precision=sum(ifelse(locale == google_translate_locale, 1, 0)) / n())
eval_data %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(locale == google_translate_locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
valid_data %>%
summarise(
langid_precision = sum(ifelse(locale == langid_locale, 1, 0)) / n(),
langdetect_precision = sum(ifelse(locale == langdetect_locale, 1, 0)) / n()
)
valid_data %>%
group_by(locale) %>%
summarise(
langid_precision = sum(ifelse(locale == langid_locale, 1, 0)) / n()
)  %>%
ggplot(aes(x = reorder(locale, langid_precision), y = langid_precision)) +
geom_bar(stat="identity")
valid_data %>%
group_by(locale) %>%
summarise(
langdetect_precision = sum(ifelse(locale == langdetect_locale, 1, 0)) / n()
)  %>%
ggplot(aes(x = reorder(locale, langdetect_precision), y = langdetect_precision)) +
geom_bar(stat="identity")
langid_langdetect <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
valid_data %>%
mutate(mix_locale = ifelse(langid_prob >= th, langid_locale, langdetect_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
langid_langdetect[nrow(langid_langdetect) + 1,] = c(th, p)
}
langid_langdetect %>%
ggplot(aes(x = threshold, y = precision)) +
geom_line()
max_precision <- (langid_langdetect %>% summarise(max_precision = max(precision)))$max_precision
langid_threshold <- head(langid_langdetect %>% filter(precision == max_precision), 1)$threshold
eval_data %>%
mutate(mix_locale = ifelse(langid_prob >= langid_threshold, langid_locale, langdetect_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
langdetect_langid <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= th, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
langdetect_langid[nrow(langdetect_langid) + 1,] = c(th, p)
}
langdetect_langid %>%
ggplot(aes(x = threshold, y = precision)) +
geom_line()
max_precision <- (langdetect_langid %>% summarise(max_precision = max(precision)))$max_precision
langdetect_threshold <- head(langdetect_langid %>% filter(precision == max_precision), 1)$threshold
eval_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
eval_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langid_prob, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
debug_sample <- head(
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
mutate(id = Unnamed..0.1) %>%
filter(mix_locale != locale) %>%
select(id, curated_value, locale, mix_locale, langdetect_locale, langdetect_prob, langid_locale, langid_prob),
100
)
View(debug_sample)
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
eval_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
library(tidyverse)
eval_data <- read.csv(
"data/eval_data.csv",
sep="\t",
blank.lines.skip=TRUE,
stringsAsFactors=FALSE
)
eval_data <- eval_data %>%
mutate(
langid_prob = as.numeric(langid_prob),
langdetect_prob = as.numeric(langdetect_prob)
)
valid_data <- read.csv(
"data/valid_data.csv",
sep="\t",
blank.lines.skip=TRUE,
stringsAsFactors=FALSE
)
valid_data <- valid_data %>%
mutate(
langid_prob = as.numeric(langid_prob),
langdetect_prob = as.numeric(langdetect_prob)
)
head(eval_data)
eval_data %>%
summarise(precision=sum(ifelse(locale == google_translate_locale, 1, 0)) / n())
eval_data %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(locale == google_translate_locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
valid_data %>%
summarise(
langid_precision = sum(ifelse(locale == langid_locale, 1, 0)) / n(),
langdetect_precision = sum(ifelse(locale == langdetect_locale, 1, 0)) / n()
)
valid_data %>%
group_by(locale) %>%
summarise(
langid_precision = sum(ifelse(locale == langid_locale, 1, 0)) / n()
)  %>%
ggplot(aes(x = reorder(locale, langid_precision), y = langid_precision)) +
geom_bar(stat="identity")
valid_data %>%
group_by(locale) %>%
summarise(
langdetect_precision = sum(ifelse(locale == langdetect_locale, 1, 0)) / n()
)  %>%
ggplot(aes(x = reorder(locale, langdetect_precision), y = langdetect_precision)) +
geom_bar(stat="identity")
langid_langdetect <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
valid_data %>%
mutate(mix_locale = ifelse(langid_prob >= th, langid_locale, langdetect_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
langid_langdetect[nrow(langid_langdetect) + 1,] = c(th, p)
}
langid_langdetect %>%
ggplot(aes(x = threshold, y = precision)) +
geom_line()
max_precision <- (langid_langdetect %>% summarise(max_precision = max(precision)))$max_precision
langid_threshold <- head(langid_langdetect %>% filter(precision == max_precision), 1)$threshold
eval_data %>%
mutate(mix_locale = ifelse(langid_prob >= langid_threshold, langid_locale, langdetect_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
langdetect_langid <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= th, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
langdetect_langid[nrow(langdetect_langid) + 1,] = c(th, p)
}
langdetect_langid %>%
ggplot(aes(x = threshold, y = precision)) +
geom_line()
max_precision <- (langdetect_langid %>% summarise(max_precision = max(precision)))$max_precision
langdetect_threshold <- head(langdetect_langid %>% filter(precision == max_precision), 1)$threshold
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
eval_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
eval_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langid_prob, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
debug_sample <- head(
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
mutate(id = Unnamed..0.1) %>%
filter(mix_locale != locale) %>%
select(id, curated_value, locale, mix_locale, langdetect_locale, langdetect_prob, langid_locale, langid_prob),
100
)
View(debug_sample)
View(eval_data)
eval_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) %>%
geom_bar(stat="identity")
eval_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
debug_sample <- head(
valid_data %>%
filter(locale == "ms") %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
mutate(id = Unnamed..0.1) %>%
filter(mix_locale != locale) %>%
select(id, curated_value, locale, mix_locale, langdetect_locale, langdetect_prob, langid_locale, langid_prob),
100
)
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
valid_data %>%
mutate(langdetect_locale = ifelse(langdetect_locale == "id", "ms", langdetect_locale)) %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
valid_data %>%
# mutate(langdetect_locale = ifelse(langdetect_locale == "id", "ms", langdetect_locale)) %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
valid_data %>%
mutate(langdetect_locale = ifelse(langdetect_locale == "id", "ms", langdetect_locale)) %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
valid_data %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
valid_data %>%
mutate(langdetect_locale = ifelse(langdetect_locale == "id", "ms", langdetect_locale)) %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
debug_sample <- head(
valid_data %>%
filter(locale == "id") %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
mutate(id = Unnamed..0.1) %>%
filter(mix_locale != locale) %>%
select(id, curated_value, locale, mix_locale, langdetect_locale, langdetect_prob, langid_locale, langid_prob),
100
)
debug_sample <- head(
valid_data %>%
filter(locale == "no") %>%
mutate(mix_locale = ifelse(langdetect_prob >= langdetect_threshold, langdetect_locale, langid_locale)) %>%
mutate(id = Unnamed..0.1) %>%
filter(mix_locale != locale) %>%
select(id, curated_value, locale, mix_locale, langdetect_locale, langdetect_prob, langid_locale, langid_prob),
100
)
langdetect_locales <- unique(valid_data$langdetect_locale)
langdetect_thresholds <- data.frame(threshold = numeric(), locale = character())
for (locale in langdetect_locales) {
for (th in langdetect_thresholds) {
langdetect_thresholds[nrow(langdetect_thresholds) + 1, ] = c(th, locale)
}
}
View(langdetect_thresholds)
for (locale in langdetect_locales) {
for (th in seq(0, 1, by=0.1)) {
langdetect_thresholds[nrow(langdetect_thresholds) + 1, ] = c(th, locale)
}
}
langdetect_locales <- unique(valid_data$langdetect_locale)
langdetect_thresholds <- data.frame(threshold = numeric(), locale = character())
for (locale in langdetect_locales) {
for (th in seq(0, 1, by=0.1)) {
langdetect_thresholds[nrow(langdetect_thresholds) + 1, ] = c(th, locale)
}
}
type(langdetect_locales)
class(langdetect_locales)
langdetect_locales <- unique(valid_data$langdetect_locale)
langdetect_thresholds <- data.frame(threshold = numeric(), locale = character())
for (locale in langdetect_locales) {
for (th in seq(0, 1, by=0.1)) {
langdetect_thresholds[nrow(langdetect_thresholds) + 1, ] = c(th, locale)
}
}
unique(valid_data$langdetect_locale)
unique(valid_data$langdetect_locale)[1]
unique(valid_data$langdetect_locale)[2]
unique(valid_data$langdetect_locale)[3]
class(unique(valid_data$langdetect_locale))
langdetect_locales <- unique(valid_data$langdetect_locale)
langdetect_thresholds <- data.frame(threshold = numeric(), locale = character(), stringsAsFactors = FALSE)
for (locale in langdetect_locales) {
for (th in seq(0, 1, by=0.1)) {
langdetect_thresholds[nrow(langdetect_thresholds) + 1, ] = c(th, locale)
}
}
zh_precision <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
valid_data %>%
filter(locale == "zh") %>%
mutate(mix_locale = ifelse(langdetect_prob >= th, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
zh_precision[nrow(zh_precision) + 1,] = c(th, p)
}
zh_precision %>%
ggplot(aes(x = threshold, y = precision)) +
geom_line()
get_threshold <- function(df, locale_name) {
precision_df <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
df %>%
filter(locale == locale_name) %>%
mutate(mix_locale = ifelse(langdetect_prob >= th, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
precision_df[nrow(precision_df) + 1,] = c(th, p)
}
max_precision <- (precision_df %>% summarise(max_precision = max(precision)))$max_precision
max_threshold <- head(precision_df %>% filter(precision == max_precision), 1)$threshold
return <- c(threshold = max_threshold, locale = locale_name)
}
get_threshold(valid_data, "zh")
get_threshold <- function(df, locale_name) {
precision_df <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
df %>%
filter(locale == locale_name) %>%
mutate(mix_locale = ifelse(langdetect_prob >= th, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
precision_df[nrow(precision_df) + 1,] = c(th, p)
}
max_precision <- (precision_df %>% summarise(max_precision = max(precision)))$max_precision
max_threshold <- head(precision_df %>% filter(precision == max_precision), 1)$threshold
return <- c(threshold = max_threshold, locale = locale_name)
return
}
get_threshold(valid_data, "zh")
get_threshold(valid_data, "en")
get_threshold(valid_data, "es")
get_threshold <- function(df, locale_name) {
precision_df <- data.frame(threshold = numeric(), precision=numeric())
for (th in seq(0, 1, by=0.01)) {
p <- (
df %>%
filter(locale == locale_name) %>%
mutate(mix_locale = ifelse(langdetect_prob >= th, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(!is.na(mix_locale) & mix_locale == locale, 1, 0)) / n())
)$precision
precision_df[nrow(precision_df) + 1,] = c(th, p)
}
max_precision <- (precision_df %>% summarise(max_precision = max(precision)))$max_precision
max_threshold <- head(precision_df %>% filter(precision == max_precision), 1)$threshold
max_threshold
}
locales <- unique(valid_data$locale)
thresholds <- data.frame(locale = character(), threshold = numeric(), stringsAsFactors = FALSE)
for (locale in locales) {
thresholds[nrow(thresholds) + 1, ] = c(locale, get_threshold(valid_data, locale))
}
View(thresholds)
locales <- unique(valid_data$locale)
thresholds <- data.frame(langdetect_locale = character(), threshold = numeric(), stringsAsFactors = FALSE)
for (locale in locales) {
thresholds[nrow(thresholds) + 1, ] = c(locale, get_threshold(valid_data, locale))
}
merge(
valid_data,
thresholds,
by = c("langdetect_locale")
) %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n())
merge(
eval_data,
thresholds,
by = c("langdetect_locale")
) %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n())
merge(
eval_data,
thresholds,
by = c("langdetect_locale")
) %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
merge(
valid_data,
thresholds,
by = c("langdetect_locale")
) %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
merge(
valid_data,
thresholds,
by = c("langdetect_locale")
) %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
View(thresholds)
View(valid_data)
merge(
valid_data,
thresholds,
by = c("langdetect_locale")
) %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n()) %>%
group_by(locale) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
merge(
valid_data,
thresholds,
by = c("langdetect_locale")
) %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
group_by(locale) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n()) %>%
ggplot(aes(x = reorder(locale, precision), y = precision)) +
geom_bar(stat="identity")
merge(
eval_data,
thresholds,
by = c("langdetect_locale")
) %>%
filter(locale != "ms") %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n())
merge(
eval_data,
thresholds,
by = c("langdetect_locale")
) %>%
filter(locale != "ms", locale != "is") %>%
mutate(pred_locale = ifelse(!is.na(langdetect_locale) & langdetect_prob >= threshold, langdetect_locale, langid_locale)) %>%
summarise(precision = sum(ifelse(pred_locale == locale, 1, 0)) / n())
